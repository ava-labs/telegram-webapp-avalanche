import{B as L,o as z,q as j,d as p,n as R,r as J,t as B,_ as $,D as K,x as E,j as Y,f as I,k as G,y as A,z as X,b as x,N as k,s as Z,u as O,p as ee,l as ne,v as ae,m as te}from"./index-85f30e3b.js";const se=e=>e;class ie extends L{constructor({body:a,error:t,url:c}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${se(c)}`,`Request body: ${z(a)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code}}const ce=-1;class re extends L{constructor(a,{code:t,docsPath:c,metaMessages:s,name:n,shortMessage:i}){super(i,{cause:a,docsPath:c,metaMessages:s||(a==null?void 0:a.metaMessages),name:n||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=n||a.name,this.code=a instanceof ie?a.code:t??ce}}class H extends re{constructor(a,t){super(a,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class M extends H{constructor(a){super(a,{code:M.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(M,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class _ extends H{constructor(a){super(a,{code:_.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(_,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const N="wallet_addEthereumChain",oe=!0,q={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};function me(e){return e.id==="walletConnect"}async function pe(e,a,t,c,s){var g,y;const n=await F(e,t,s),i=e.walletConnect;let{onDisplayUri:d}=i||{};if(!d&&s&&t!=="walletConnect"){const m=await j(t);d=b=>{const T=m.mobile.native||m.mobile.universal;if(!T)throw new Error("No app url found for wallet connect to redirect to.");const v=X(T,b).redirect;s(v)}}d&&n.events.addListener("display_uri",d);let l=i==null?void 0:i.optionalChains,r=e.chain;t==="global.safe"&&(l=V.map(p),r&&!l.includes(r)&&(r=void 0));const{rpcMap:o,chainsToRequest:u}=Q({client:e.client,chain:r,optionalChains:l});n.session&&await n.connect({...i!=null&&i.pairingTopic?{pairingTopic:i==null?void 0:i.pairingTopic}:{},optionalChains:u,chains:r?[r.id]:u.length>0?[u[0]]:[1],rpcMap:o}),U(u,c);const h=(await n.enable())[0];if(!h)throw new Error("No accounts found on provider.");const C=R(n.chainId),w=e.chain&&e.chain.id===C?e.chain:p(C);if(e){const m={optionalChains:(g=e.walletConnect)==null?void 0:g.optionalChains,chain:e.chain,pairingTopic:(y=e.walletConnect)==null?void 0:y.pairingTopic};c&&J(c,t,m)}return i!=null&&i.onDisplayUri&&n.events.removeListener("display_uri",i.onDisplayUri),W(h,w,n,a,c)}async function Ce(e,a,t,c,s){const n=c?await B(c,t):null,i=await F(n?{chain:n.chain,client:e.client,walletConnect:{pairingTopic:n.pairingTopic,optionalChains:n.optionalChains}}:{client:e.client,walletConnect:{}},t,s,!0),d=i.accounts[0];if(!d)throw new Error("No accounts found on provider.");const l=R(i.chainId),r=e.chain&&e.chain.id===l?e.chain:p(l);return W(d,r,i,a,c)}async function F(e,a,t,c=!1){var C,w,g,y;const s=await j(a),n=e.walletConnect,{EthereumProvider:i,OPTIONAL_EVENTS:d,OPTIONAL_METHODS:l}=await $(()=>import("./index.es-05000a7c.js"),["assets/index.es-05000a7c.js","assets/index-85f30e3b.js","assets/index-b41033e1.css"]);let r=n==null?void 0:n.optionalChains,o=e.chain;a==="global.safe"&&(r=V.map(p),o&&!r.includes(o)&&(o=void 0));const{rpcMap:u,chainsToRequest:f}=Q({client:e.client,chain:o,optionalChains:r}),h=await i.init({showQrModal:(n==null?void 0:n.showQrModal)===void 0?t?!1:oe:n.showQrModal,projectId:(n==null?void 0:n.projectId)||K,optionalMethods:l,optionalEvents:d,optionalChains:f,chains:o?[o.id]:f.length>0?[f[0]]:[1],metadata:{name:((C=n==null?void 0:n.appMetadata)==null?void 0:C.name)||E().name,description:((w=n==null?void 0:n.appMetadata)==null?void 0:w.description)||E().description,url:((g=n==null?void 0:n.appMetadata)==null?void 0:g.url)||E().url,icons:[((y=n==null?void 0:n.appMetadata)==null?void 0:y.logoUrl)||E().logoUrl]},rpcMap:u,qrModalOptions:n==null?void 0:n.qrModalOptions,disableProviderPing:!0});if(h.events.setMaxListeners(Number.POSITIVE_INFINITY),c||h.session&&await h.disconnect(),a!=="walletConnect"){let m=function(){var b,T,v,D;const P=((D=(v=(T=(b=h.session)==null?void 0:b.peer)==null?void 0:T.metadata)==null?void 0:v.redirect)==null?void 0:D.native)||s.mobile.native||s.mobile.universal;t&&P&&t(P)};h.signer.client.on("session_request_sent",m),h.events.addListener("disconnect",()=>{h.signer.client.off("session_request_sent",m)})}return h}function S(e,a){return{address:x(a),async sendTransaction(s){return{transactionHash:await e.request({method:"eth_sendTransaction",params:[{gas:s.gas?I(s.gas):void 0,value:s.value?I(s.value):void 0,from:this.address,to:s.to,data:s.data}]})}},async signMessage({message:s}){const n=(()=>typeof s=="string"?Z(s):s.raw instanceof Uint8Array?O(s.raw):s.raw)();return e.request({method:"personal_sign",params:[n,this.address]})},async signTypedData(s){const n=ee(s),{domain:i,message:d,primaryType:l}=n,r={EIP712Domain:ne({domain:i}),...n.types};ae({domain:i,message:d,primaryType:l,types:r});const o=te({domain:i??{},message:d,primaryType:l,types:r});return await e.request({method:"eth_signTypedData_v4",params:[this.address,o]})}}}function W(e,a,t,c,s){const n=S(t,e);async function i(){t.removeListener("accountsChanged",l),t.removeListener("chainChanged",r),t.removeListener("disconnect",d),await t.disconnect()}function d(){U([],s),s==null||s.removeItem(q.lastUsedChainId),i(),c.emit("disconnect",void 0)}function l(o){if(o[0]){const u=S(t,x(o[0]));c.emit("accountChanged",u),c.emit("accountsChanged",o)}else d()}function r(o){const u=p(R(o));c.emit("chainChanged",u),s==null||s.setItem(q.lastUsedChainId,String(o))}return t.on("accountsChanged",l),t.on("chainChanged",r),t.on("disconnect",d),t.on("session_delete",d),[n,a,i,o=>ue(t,o,s)]}function de(e){var a,t;return((t=(a=e.session)==null?void 0:a.namespaces[k])==null?void 0:t.methods)||[]}function le(e){var t,c,s;return((s=(c=(t=e.session)==null?void 0:t.namespaces[k])==null?void 0:c.chains)==null?void 0:s.map(n=>Number.parseInt(n.split(":")[1]||"")))??[]}async function ue(e,a,t){var s,n;const c=a.id;try{const i=le(e),d=de(e);if(!i.includes(c)&&d.includes(N)){const r=await Y(a),o=[...new Set([...((s=a.blockExplorers)==null?void 0:s.map(f=>f.url))||[],...((n=r.explorers)==null?void 0:n.map(f=>f.url))||[]])];await e.request({method:N,params:[{chainId:I(r.chainId),chainName:r.name,nativeCurrency:r.nativeCurrency,rpcUrls:G(r),blockExplorerUrls:o.length>0?o:void 0}]});const u=await he(t);u.push(c),U(u,t)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:I(c)}]})}catch(i){const d=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(d)?new M(i):new _(i)}}function U(e,a){a==null||a.setItem(q.requestedChains,JSON.stringify(e))}async function he(e){const a=await e.getItem(q.requestedChains);return a?JSON.parse(a):[]}function Q(e){const a={};e.chain&&(a[e.chain.id]=A({chain:e.chain,client:e.client}));const t=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const n of t)a[n.id]=A({chain:n,client:e.client});const c=t.map(n=>n.id)||[],s=e.chain?[e.chain.id,...c]:c.length>0?c:[1];return!e.chain&&t.length===0&&(a[1]=p(1).rpc),{rpcMap:a,chainsToRequest:s}}const V=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{Ce as autoConnectWC,pe as connectWC,me as isWalletConnect};
