import{aB as ot,aC as It,aD as fe,aE as Et,g as ct,aF as Dt,b as Ve,aG as w,aH as t,aI as Rt,aJ as r,aK as l,aL as zt,aM as Ot,aN as Ft,aO as C,aP as rt,aQ as Z,aR as V,aS as pt,aT as Pt,aU as Te,aV as st,aW as dt,aX as _,aw as ge,aY as me,aZ as Ae,a_ as j,a$ as ee,b0 as m,b1 as We,b2 as D,b3 as Be,b4 as ye,b5 as y,b6 as ve,b7 as J,b8 as ne,b9 as Ce,ba as L,bb as Ie,bc as Mt,bd as te,be as Y,bf as Lt,bg as be,bh as Ee,ae as de,ad as Nt,bi as Ke,j as qt,bj as _t,bk as jt,bl as Ut,bm as Ht,bn as lt,bo as Qt,bp as ut,bq as $t,br as Gt,bs as Vt,bt as U,bu as ht,bv as Kt,bw as Yt,bx as we,by as Jt,bz as Zt,bA as mt,bB as Xt,bC as en,bD as Ye,bE as yt,bF as tn,bG as nn,bH as ft,bI as an,bJ as Je,bK as on,bL as gt,bM as cn,bN as ie,bO as bt,bP as wt,bQ as rn,bR as sn,d as Ze,aA as dn,bS as ln,bT as un,bU as Xe,bV as hn,bW as mn,bX as kt,bY as yn,bZ as fn,b_ as gn,b$ as bn,c0 as wn,c1 as Ct,c2 as kn,c3 as Cn,c4 as xn,c5 as Sn,c6 as et,c7 as Tn,c8 as An,c9 as Wn,ca as Bn,cb as vn,cc as In,cd as En}from"./index-85f30e3b.js";import{decimals as Dn}from"./decimals-ad11001b.js";import{getCurrencyMetadata as Rn}from"./getCurrencyMetadata-16e5eb7f.js";import"./decimals-1cb67644.js";async function tt(e){const n=await ot(e);return It(n)}function zn(e,n){return fe({...n,queryKey:["buyWithCryptoQuote",e],queryFn:()=>{if(!e)throw new Error("Swap params are required");return Et(e)},enabled:!!e,retry(i,o){if(i>3)return!1;try{const a=o.error;if(a.code==="MINIMUM_PURCHASE_AMOUNT"||a.statusCode===404||a.statusCode>=500)return!1}catch{return!0}return!0}})}async function On(e){try{const i=await ct(e.client)(Dt(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress,fromAmount:e.fromAmount,toAmount:e.toAmount,maxSlippageBPS:e.maxSlippageBPS,isTestMode:e.isTestMode,purchaseData:e.purchaseData,fromAddress:e.fromAddress,toGasAmountWei:e.toGasAmountWei})});if(!i.ok){const o=await i.json();throw o&&"error"in o?o:new Error(`HTTP error! status: ${i.status}`)}return(await i.json()).result}catch(n){throw console.error("Error getting buy with fiat quote",n),n}}function Fn(e,n){return fe({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return On(e)},enabled:!!e,retry(i,o){if(i>3)return!1;try{const a=o.error;if(a.code==="MINIMUM_PURCHASE_AMOUNT"||a.statusCode===404||a.statusCode>=500)return!1}catch{return!0}return!0}})}function xt(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,i=Ve(e.toToken.tokenAddress)===Ve(e.onRampToken.token.tokenAddress);return!(n&&i)}const St=w.forwardRef(function(n,i){return t(pn,{ref:i,children:t(Rt,{children:r(l,{p:"lg",children:[t(zt,{children:t(Ot,{type:"button","aria-label":"Close",onClick:n.close,children:t(Ft,{width:C.md,height:C.md,style:{color:"inherit"}})})}),n.children]})})})}),pn=rt(e=>{const n=Z();return{zIndex:1e4,borderTopLeftRadius:V.xl,borderTopRightRadius:V.xl,background:n.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${Pn} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${n.colors.borderColor}`}}),Pn=pt`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,Tt=rt(e=>({backgroundColor:Z().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${Pt} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function At(){const[e,n]=w.useState(!1),i=w.useRef(null),o=w.useRef(null),a=w.useCallback(()=>new Promise(u=>{var s;if(i.current){const c={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},d=i.current.animate([{transform:"translateY(100%)",opacity:0}],c);(s=o.current)==null||s.animate([{opacity:0}],c),d.onfinish=()=>u()}else u()}),[]),h=w.useCallback(async u=>{u?n(!0):(await a(),n(!1))},[a]);return w.useLayoutEffect(()=>{if(!e)return;const u=s=>{i.current&&s.target instanceof Node&&!i.current.contains(s.target)&&h(!1)};return requestAnimationFrame(()=>{document.addEventListener("click",u)}),()=>{document.removeEventListener("click",u)}},[e,h]),{drawerRef:i,drawerOverlayRef:o,setIsOpen:h,isOpen:e}}function Mn(e){var T,O,B,b,p,F;const{payUiOptions:n,supportedDestinations:i,client:o,onContinue:a,payerAccount:h}=e,u=Z(),s=Te(),c=n.metadata,d=n.paymentInfo,{data:g}=st(d.chain),{data:v}=dt({client:o,address:d.sellerAddress}),x=fe({queryKey:["amount",d],queryFn:async()=>{let R=18;d.token&&!_(d.token)&&(R=await Dn({contract:ge({address:d.token.address,chain:d.chain,client:o})}));let P;return"amountWei"in d?P=me(d.amountWei,R):P=d.amount,P}}).data;if(!g||x===void 0)return t(Ae,{});const k=d.token?{...d.token,icon:((T=d.token)==null?void 0:T.icon)||((B=(O=i.find(R=>R.chain.id===d.chain.id))==null?void 0:O.tokens.find(R=>{var P;return R.address.toLowerCase()===((P=d.token)==null?void 0:P.address.toLowerCase())}))==null?void 0:B.icon)}:{address:j,name:g.nativeCurrency.name,symbol:g.nativeCurrency.symbol,icon:(b=g.icon)==null?void 0:b.url};return r(l,{p:"lg",children:[t(ee,{title:(c==null?void 0:c.name)||"Payment Details"}),t(m,{y:"lg"}),r(l,{children:[c!=null&&c.image?t(We,{client:o,src:c==null?void 0:c.image,style:{width:"100%",borderRadius:D.md,backgroundColor:u.colors.tertiaryBg}}):s?r(l,{flex:"row",center:"both",style:{padding:D.md,marginBottom:D.md,borderRadius:D.md,backgroundColor:u.colors.tertiaryBg},children:[t(Be,{size:C.xl,id:s.id,client:o}),t("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:u.colors.secondaryIconColor,marginLeft:D.md,marginRight:D.md}}),t(ye,{client:o,size:C.xl,chainIconUrl:(p=g.icon)==null?void 0:p.url})]}):null,t(m,{y:"md"}),r(l,{flex:"row",children:[t(l,{flex:"column",expand:!0,children:t(y,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t(l,{expand:!0,children:r(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t(ve,{chain:d.chain,client:e.client,size:"sm",token:k}),r(y,{color:"primaryText",size:"md",weight:700,children:[String(J(Number(x),6))," ",k.symbol]})]})})]}),t(m,{y:"md"}),t(ne,{}),t(m,{y:"md"}),r(l,{flex:"row",children:[t(l,{flex:"column",expand:!0,children:t(y,{size:"xs",color:"secondaryText",children:"Network"})}),t(l,{expand:!0,children:r(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t(ye,{chainIconUrl:(F=g.icon)==null?void 0:F.url,size:"xs",client:e.client}),t(y,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:g.name})]})})]}),t(m,{y:"sm"}),r(l,{flex:"row",children:[t(l,{flex:"column",expand:!0,children:t(y,{size:"xs",color:"secondaryText",children:"Seller"})}),t(l,{expand:!0,children:t(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t(y,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:v||Ce(d.sellerAddress)})})})]})]}),t(m,{y:"xl"}),h?t(L,{variant:"accent",fullWidth:!0,onClick:()=>{a(x,d.chain,k)},children:"Choose Payment Method"}):t("div",{children:t(Ie,{...e.connectOptions,client:o,theme:u,connectButton:{style:{width:"100%"}}})})]})}function Wt(e){const{estimatedSeconds:n,quoteIsLoading:i}=e;return r(l,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:V.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[r(l,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t(Mt,{width:C.sm,height:C.sm}),i?t(te,{height:Y.xs,width:"50px",color:"borderColor"}):t(y,{size:"xs",color:"secondaryText",children:n!==void 0?`~${Lt(n)}`:"--"})]}),r(L,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t(l,{color:"accentText",flex:"row",center:"both",children:t(Ln,{size:C.sm})}),t(y,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const Ln=e=>r("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function Nn(e){return r(l,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:V.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[r(qn,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[t(e.currency.icon,{size:C.md}),r(l,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t(y,{color:"primaryText",children:e.currency.shorthand}),t(be,{width:C.sm,height:C.sm})]})]}),t("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:D.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:D.sm},children:e.isLoading?t(te,{width:"100px",height:Y.lg}):t(y,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${J(Number(e.value),6)}`:"--"})})]})}const qn=Ee(L)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function _n(e){const{transaction:n,account:i,supportedDestinations:o}=e,[a,h]=w.useState();return w.useEffect(()=>{Promise.all([de(n.value),de(n.erc20Value),de(n.to),Nt(n)]).then(([u,s,c,d])=>{var g;h({value:u==null?void 0:u.toString(),erc20Value:(g=s==null?void 0:s.amountWei)==null?void 0:g.toString(),erc20Currency:s==null?void 0:s.tokenAddress,to:c,data:d})})},[n]),fe({queryKey:["transaction-cost",n.chain.id,i==null?void 0:i.address,a],queryFn:async()=>{var f,x,k;if(!i)throw new Error("No account");const u=await de(n.erc20Value);if(u){const[T,O,B]=await Promise.all([Ke({address:i.address,chain:n.chain,client:n.client,tokenAddress:u.tokenAddress}),Rn({contract:ge({address:u.tokenAddress,chain:n.chain,client:n.client})}),xe(n,i==null?void 0:i.address)]),b=u.amountWei,p=T;return{token:{address:u.tokenAddress,name:O.name,symbol:O.symbol,icon:(x=(f=o.find(R=>R.chain.id===n.chain.id))==null?void 0:f.tokens.find(R=>R.address.toLowerCase()===u.tokenAddress.toLowerCase()))==null?void 0:x.icon},decimals:O.decimals,walletBalance:p,gasCostWei:B,transactionValueWei:b}}const[s,c,d]=await Promise.all([Ke({address:i.address,chain:n.chain,client:n.client}),qt(n.chain),xe(n,i==null?void 0:i.address)]),g=s,v=await de(n.value)||0n;return{token:{address:j,name:c.nativeCurrency.name,symbol:c.nativeCurrency.symbol,icon:(k=c.icon)==null?void 0:k.url},decimals:18,walletBalance:g,gasCostWei:d,transactionValueWei:v}},enabled:!!n&&!!i&&!!a,refetchInterval:()=>{if(!n.erc20Value)return 3e4}})}async function xe(e,n){try{const i=await _t({transaction:e,from:n}),o=i.wei/10n;return i.wei+o}catch{return n?await xe(e):2000000n*await jt({client:e.client,chain:e.chain})}}function jn(e){var f,x;const{payUiOptions:n,client:i,payerAccount:o,supportedDestinations:a,onContinue:h}=e,{data:u}=st(n.transaction.chain),s=n.metadata,{data:c}=_n({transaction:n.transaction,account:o,supportedDestinations:a}),d=Z(),g=Te(),v=Ut(g);return!c||!u?t(Ae,{}):r(l,{p:"lg",children:[t(ee,{title:(s==null?void 0:s.name)||"Transaction"}),t(m,{y:"lg"}),r(l,{children:[s!=null&&s.image?t(We,{client:i,src:s==null?void 0:s.image,style:{width:"100%",borderRadius:D.md,backgroundColor:d.colors.tertiaryBg}}):g?r(l,{flex:"row",center:"both",style:{padding:D.md,marginBottom:D.md,borderRadius:D.md,backgroundColor:d.colors.tertiaryBg},children:[t(Be,{size:C.xl,id:g.id,client:i}),t("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:d.colors.secondaryIconColor,marginLeft:D.md,marginRight:D.md}}),t(ye,{client:i,size:C.xl,chainIconUrl:(f=u.icon)==null?void 0:f.url})]}):null,t(m,{y:"md"}),r(l,{flex:"row",children:[t(l,{flex:"column",expand:!0,children:t(y,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t(l,{expand:!0,children:r(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t(ve,{chain:n.transaction.chain,client:e.client,size:"sm",token:c.token}),r(y,{color:"primaryText",size:"md",weight:700,children:[String(J(Number(me(c.transactionValueWei,c.decimals)),6))," ",c.token.symbol]})]})})]}),t(m,{y:"md"}),t(ne,{}),t(m,{y:"md"}),r(l,{flex:"row",children:[t(l,{flex:"column",expand:!0,children:t(y,{size:"xs",color:"secondaryText",children:"Gas Fees"})}),t(l,{expand:!0,children:t(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t(y,{color:v?"success":"primaryText",size:"xs",children:v?"Sponsored":`${String(J(Number(me(c.gasCostWei,u.nativeCurrency.decimals)),6))} ${u.nativeCurrency.symbol}`})})})]}),t(m,{y:"sm"}),r(l,{flex:"row",children:[t(l,{flex:"column",expand:!0,children:t(y,{size:"xs",color:"secondaryText",children:"Network"})}),t(l,{expand:!0,children:r(l,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t(ye,{chainIconUrl:(x=u.icon)==null?void 0:x.url,size:"xs",client:e.client}),t(y,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:u.name})]})})]})]}),t(m,{y:"xl"}),o?t(L,{variant:"accent",fullWidth:!0,onClick:()=>{let k=c.transactionValueWei;c.token.address===j&&!v&&(k+=c.gasCostWei),h(me(k,c.decimals),n.transaction.chain,c.token)},children:"Choose Payment Method"}):t("div",{children:t(Ie,{...e.connectOptions,client:i,theme:d,connectButton:{style:{width:"100%"}}})})]})}function Bt(e){const n=Z();return t(l,{bg:"tertiaryBg",style:{borderRadius:V.lg,border:`1px solid ${n.colors.borderColor}`,...e.containerStyle},children:r(L,{fullWidth:!0,disabled:e.disabled,onClick:e.onClick,variant:"ghost",style:{justifyContent:"space-between",padding:D.sm,backgroundColor:n.colors.tertiaryBg},gap:"sm",children:[t(Se,{client:e.client,address:e.address}),!e.disableChevron&&t(be,{width:C.sm,height:C.sm,style:{color:n.colors.secondaryText}}),e.checked&&t(Ht,{width:C.md,height:C.md})]})})}function Se(e){const{client:n,address:i}=e,a=lt().find(d=>{var g;return((g=d.getAccount())==null?void 0:g.address)===e.address}),h=e.walletId||(a==null?void 0:a.id),u=dt({client:n,address:i}),s=u.data||Ce(i),c=Qt({client:n,ensName:u.data});return r(l,{flex:"row",center:"y",gap:"sm",color:"secondaryText",children:[c.data?t(We,{src:c.data,width:C.md,height:C.md,style:{borderRadius:V.sm},client:e.client}):h?t(Be,{id:h,size:C.md,client:e.client}):null,t(y,{size:"sm",color:"primaryText",children:s||Ce(e.address)})]})}function Un(e){return r(l,{children:[t(l,{p:"lg",children:t(ee,{title:"Pay with",onBack:e.onBack})}),t(ne,{}),t(m,{y:"lg"}),t(l,{flex:"column",gap:"xs",px:"lg",children:ut.map(n=>r(Hn,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[t(n.icon,{size:C.lg}),r(l,{flex:"column",gap:"xxs",children:[t(y,{color:"primaryText",children:n.shorthand}),t(y,{size:"sm",children:n.name})]})]},n.shorthand))}),t(m,{y:"lg"})]})}const Hn=Ee(L)(()=>{const e=Z();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:D.sm,padding:D.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}});function vt(e,n){const a=(window.innerHeight-750)/2,h=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=500, height=750, top=${a}, left=${h}`)}function Qn(e){var c,d,g,v;const n=$t(),{openedWindow:i,onSuccess:o}=e,a=Gt({intentId:e.intentId,client:e.client});let h="loading";((c=a.data)==null?void 0:c.status)==="ON_RAMP_TRANSFER_FAILED"||((d=a.data)==null?void 0:d.status)==="PAYMENT_FAILED"?h="failed":((g=a.data)==null?void 0:g.status)==="CRYPTO_SWAP_FALLBACK"?h="partialSuccess":((v=a.data)==null?void 0:v.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(h="completed");const u=w.useRef(!1);w.useEffect(()=>{var f;u.current||!o||((f=a.data)==null?void 0:f.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(u.current=!0,o(a.data))},[o,a.data]),w.useEffect(()=>{var f,x;!i||!a.data||(((f=a.data)==null?void 0:f.status)==="CRYPTO_SWAP_REQUIRED"||((x=a.data)==null?void 0:x.status)==="ON_RAMP_TRANSFER_COMPLETED")&&i.close()},[a.data,i]);const s=w.useRef(!1);return w.useEffect(()=>{var f;!s.current&&((f=a.data)==null?void 0:f.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(s.current=!0,Vt(n))},[a.data,n]),w.useEffect(()=>{var f;((f=a.data)==null?void 0:f.status)==="CRYPTO_SWAP_REQUIRED"&&e.onShowSwapFlow(a.data)},[a.data,e.onShowSwapFlow]),r(l,{p:"lg",children:[t(ee,{title:e.title,onBack:e.onBack}),e.hasTwoSteps&&r(U,{children:[t(m,{y:"lg"}),t(ht,{steps:2,currentStep:1}),t(m,{y:"sm"}),r(y,{size:"xs",children:["Step 1 of 2 - Buying ",e.quote.onRampToken.token.symbol," with"," ",e.quote.fromCurrencyWithFees.currencySymbol]})]}),t($n,{uiStatus:h,onDone:e.onDone,fiatStatus:a.data,client:e.client,transactionMode:e.transactionMode,quote:e.quote,isEmbed:e.isEmbed})]})}function $n(e){const{uiStatus:n}=e,i=e.fiatStatus?Kt(e.fiatStatus):void 0,o=e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"?e.fiatStatus:void 0,a=e.quote.onRampToken,h=t(Yt,{client:e.client,token:o!=null&&o.source?{chainId:o.source.token.chainId,address:o.source.token.tokenAddress,symbol:o.source.token.symbol||"",amount:o.source.amount}:{chainId:a.token.chainId,address:a.token.tokenAddress,symbol:a.token.symbol,amount:a.amount},fiat:{amount:e.quote.fromCurrencyWithFees.amount,currencySymbol:e.quote.fromCurrencyWithFees.currencySymbol},statusMeta:o!=null&&o.source&&i?{color:i==null?void 0:i.color,text:i==null?void 0:i.status,txHash:o.source.transactionHash}:void 0});return r(l,{children:[t(m,{y:"xl"}),n==="loading"&&r(U,{children:[t(m,{y:"md"}),t(l,{flex:"row",center:"x",children:t(we,{size:"xxl",color:"accentText"})}),t(m,{y:"md"}),t(y,{color:"primaryText",size:"lg",center:!0,children:"Buy Pending"}),t(m,{y:"sm"}),!Jt()&&t(y,{center:!0,children:"Complete the purchase in popup"}),t(m,{y:"xxl"}),h]}),n==="failed"&&r(U,{children:[t(m,{y:"md"}),t(l,{flex:"row",center:"x",children:t(Zt,{size:C["3xl"]})}),t(m,{y:"lg"}),t(y,{color:"primaryText",size:"lg",center:!0,children:"Transaction Failed"}),t(m,{y:"xxl"}),h]}),n==="completed"&&r(U,{children:[t(m,{y:"md"}),t(l,{flex:"row",center:"x",color:"success",children:t(mt,{width:C["3xl"],height:C["3xl"]})}),t(m,{y:"md"}),t(y,{color:"primaryText",size:"lg",center:!0,children:"Buy Complete"}),e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"&&r(U,{children:[t(m,{y:"xxl"}),h,t(m,{y:"sm"})]}),!e.isEmbed&&t(L,{variant:"accent",fullWidth:!0,onClick:e.onDone,children:e.transactionMode?"Continue Transaction":"Done"})]})]})}function Gn(e){const n=xt(e.quote),[i,o]=w.useState(n?{id:"step-1"}:{id:"onramp-status"}),[a,h]=w.useState(e.openedWindow),u=w.useCallback(()=>{Xt({intentId:e.quote.intentId,client:e.client}).then(s=>{e.onSuccess(s)})},[e.onSuccess,e.quote.intentId,e.client]);return i.id==="step-1"?t(en,{title:e.title,client:e.client,onBack:e.onBack,partialQuote:Ye(e.quote),step:1,onContinue:()=>{const s=vt(e.quote.onRampLink,e.theme);yt({type:"fiat",intentId:e.quote.intentId}),h(s),o({id:"onramp-status"})}}):i.id==="onramp-status"?t(Qn,{title:e.title,client:e.client,intentId:e.quote.intentId,onBack:e.onBack,hasTwoSteps:n,openedWindow:a,quote:e.quote,onDone:e.onDone,onShowSwapFlow:s=>{o({id:"postonramp-swap",data:s})},transactionMode:e.transactionMode,isEmbed:e.isEmbed,onSuccess:e.onSuccess}):i.id==="postonramp-swap"?t(tn,{title:e.title,status:i.data,quote:Ye(e.quote),client:e.client,onBack:e.onBack,onDone:e.onDone,onSwapFlowStarted:()=>{},transactionMode:e.transactionMode,isEmbed:e.isEmbed,payer:e.payer,onSuccess:u}):null}function Vn(e){const{payOptions:n,supportedDestinations:i,toChain:o,toToken:a}=e;function h(){const v=i.find(k=>k.chain.id===o.id);if(!v)return{fiat:!1,swap:!1};const f=_(a)?j:a.address,x=v.tokens.find(k=>k.address.toLowerCase()===f.toLowerCase());return x?{fiat:x.buyWithFiatEnabled,swap:x.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:u,swap:s}=h(),c=n.buyWithFiat!==!1&&u,d=n.buyWithCrypto!==!1&&s;return{buyWithFiatEnabled:c,buyWithCryptoEnabled:d,showPaymentSelection:c&&d}}const nt=nn({id:137,name:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function Kn(e){var R,P,E,q,A,z,Q,H,M,$,N;const n=ft(),{payOptions:i,supportedDestinations:o}=e,a=i==null?void 0:i.prefillBuy,h=(a==null?void 0:a.amount)||"",[u,s]=w.useState(h),c=an(u,300),[d,g]=w.useState((a==null?void 0:a.chain)||i.mode==="transaction"&&((R=i.transaction)==null?void 0:R.chain)||i.mode==="direct_payment"&&((P=i.paymentInfo)==null?void 0:P.chain)||((E=o.find(G=>G.chain.id===(n==null?void 0:n.id)))==null?void 0:E.chain)||nt),[v,f]=w.useState((a==null?void 0:a.token)||i.mode==="direct_payment"&&i.paymentInfo.token||Je),[x,k]=w.useState(i.buyWithCrypto!==!1&&((A=(q=i.buyWithCrypto)==null?void 0:q.prefillSource)==null?void 0:A.chain)||i.mode==="transaction"&&((z=i.transaction)==null?void 0:z.chain)||i.mode==="direct_payment"&&((Q=i.paymentInfo)==null?void 0:Q.chain)||nt),[T,O]=w.useState(i.buyWithCrypto!==!1&&((M=(H=i.buyWithCrypto)==null?void 0:H.prefillSource)==null?void 0:M.token)||i.mode==="direct_payment"&&i.paymentInfo.token||Je),b=(i.buyWithFiat!==!1?(N=($=i.buyWithFiat)==null?void 0:$.prefillSource)==null?void 0:N.currency:void 0)||Yn(),[p,F]=w.useState(ut.find(G=>G.shorthand===b)||on);return{tokenAmount:u,setTokenAmount:s,toChain:d,setToChain:g,deferredTokenAmount:c,fromChain:x,setFromChain:k,toToken:v,setToToken:f,fromToken:T,setFromToken:O,selectedCurrency:p,setSelectedCurrency:F}}function Yn(){try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone.toLowerCase();return e.includes("london")?"GBP":e.includes("europe")?"EUR":e.includes("japan")?"JPY":e.includes("canada")?"CAD":"USD"}catch{return"USD"}}function Jn(e){return e.length>10?"26px":e.length>6?"34px":"50px"}function Zn(e){const{name:n}=gt(e.chain),i=()=>{let o=e.value.replace(".","").length;return e.value.includes(".")&&(o+=.3),`calc(${`${Math.max(1,o)}ch`} + 6px)`};return r(l,{children:[t("div",{onClick:o=>{var a;(a=o.currentTarget.querySelector("input"))==null||a.focus()},children:r(l,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t(cn,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:o=>{e.value===""&&o.currentTarget.setSelectionRange(o.currentTarget.value.length,o.currentTarget.value.length)},onChange:o=>{let a=o.target.value;a.startsWith(".")&&(a=`0${a}`);const h=Number(a);Number.isNaN(h)||(a.startsWith("0")&&!a.startsWith("0.")?e.onChange(a.slice(1)):e.onChange(a))},style:{border:"none",fontSize:Jn(e.value),boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:i(),maxWidth:"calc(100% - 100px)"}}),t(ie,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),!e.hideTokenSelector&&r(U,{children:[t(m,{y:"sm"}),t(l,{flex:"row",center:"x",children:r(Xn,{variant:"secondary",fullWidth:!0,style:{fontSize:Y.sm},gap:"xxs",onClick:e.onSelectToken,disabled:e.freezeChainAndToken,children:[r(l,{flex:"row",center:"y",gap:"sm",children:[t(ve,{token:e.token,chain:e.chain,size:"md",client:e.client}),r(l,{flex:"column",style:{gap:"4px"},children:[t(ie,{token:e.token,chain:e.chain,size:"sm"}),n?t(y,{size:"xs",color:"secondaryText",children:n}):t(te,{width:"90px",height:Y.xs})]})]}),t(be,{width:C.sm,height:C.sm,style:{marginLeft:"auto"}})]})})]})]})}const Xn=Ee(L)(()=>{const e=Z();return{background:e.colors.tertiaryBg,border:`1px solid ${e.colors.borderColor}`,justifyContent:"flex-start",transition:"background 0.3s",padding:D.sm}}),ei=e=>t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",width:e.size,height:e.size,role:"presentation",children:t("path",{fill:"currentColor",d:"M15.6 4.6H1.85v-.55l12.1-.968v.968h1.65V2.4c0-1.21-.98-2.059-2.177-1.888L2.378 2.089C1.18 2.26.2 3.39.2 4.6v11a2.2 2.2 0 002.2 2.2h13.2a2.2 2.2 0 002.2-2.2V6.8a2.2 2.2 0 00-2.2-2.2zm-1.65 7.707a1.65 1.65 0 01-.63-3.176 1.65 1.65 0 11.63 3.176z"})});function ti(e){const{name:n}=gt(e.chain),i=bt({address:e.payerAccount.address,chain:e.chain,tokenAddress:_(e.token)?void 0:e.token.address,client:e.client});return r(l,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderWidth:"1px",borderTopWidth:0,borderStyle:"solid",flexWrap:"nowrap",justifyContent:"space-between",minHeight:"64px",alignItems:"center",...e.swapRequired?{borderBottom:"none"}:{borderBottomLeftRadius:V.md,borderBottomRightRadius:V.md}},children:[r(L,{variant:"ghost",onClick:e.onSelectToken,gap:"sm",style:{paddingInline:D.sm,paddingBlock:D.sm,minWidth:"50%",justifyContent:"flex-start"},disabled:e.freezeChainAndTokenSelection,children:[t(wt,{token:e.token,chain:e.chain,size:"md",client:e.client}),r(l,{flex:"column",gap:"3xs",children:[r(l,{flex:"row",gap:"xs",center:"y",color:"primaryText",children:[t(ie,{token:e.token,chain:e.chain,size:"sm"}),t(be,{width:C.sm,height:C.sm})]}),n?t(y,{size:"xs",children:n}):t(te,{width:"90px",height:Y.xs})]})]}),r("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:D.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:D.sm},children:[e.isLoading?t(te,{width:"120px",height:Y.md,color:"borderColor"}):t(y,{size:"md",color:e.value?"primaryText":"secondaryText",style:{},children:J(Number(e.value),6)||""}),r(l,{flex:"row",gap:"xxs",center:"y",color:"secondaryText",children:[t(ei,{size:Y.xs}),i.data?t(y,{size:"xs",color:"secondaryText",weight:500,children:rn(i.data,!1)}):t(te,{width:"70px",height:Y.xs})]})]})]})}async function ni(e){try{const i=await ct(e.client)(sn(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({fromAddress:e.fromAddress,toAddress:e.toAddress,chainId:e.chainId,tokenAddress:e.tokenAddress,amount:e.amount,purchaseData:e.purchaseData})});if(!i.ok){const h=await i.json();throw h&&"error"in h?h:new Error(`HTTP error! status: ${i.status}`)}const o=(await i.json()).result;return{transactionRequest:{chain:Ze(o.transactionRequest.chainId),client:e.client,data:o.transactionRequest.data,to:o.transactionRequest.to,value:BigInt(o.transactionRequest.value),gas:BigInt(o.transactionRequest.gasLimit)},approval:o.approval?dn({contract:ge({client:e.client,address:o.approval.tokenAddress,chain:Ze(o.approval.chainId)}),spender:o.approval.spenderAddress,amountWei:BigInt(o.approval.amountWei)}):void 0,fromAddress:o.fromAddress,toAddress:o.toAddress,paymentToken:o.paymentToken,processingFee:o.processingFee,estimatedGasCostUSDCents:o.estimatedGasCostUSDCents,client:e.client}}catch(n){throw console.error("Error getting buy with crypto transfer",n),n}}function ii(e){const{title:n,onBack:i,receiverAddress:o,client:a,payer:h,onDone:u,chain:s,token:c,tokenAmount:d,transactionMode:g,setTransactionHash:v}=e,[f,x]=w.useState("transfer"),[k,T]=w.useState("idle"),{symbol:O}=ln(s);return r(l,{p:"lg",children:[t(ee,{title:n,onBack:i}),t(m,{y:"xl"}),g&&r(U,{children:[t(ht,{steps:2,currentStep:f==="transfer"?1:2}),t(m,{y:"sm"}),t(y,{size:"sm",children:f==="transfer"?"Step 1 of 2 - Transfer funds":"Step 2 of 2 - Finalize transaction"}),t(m,{y:"xl"})]}),r(l,{flex:"row",center:"y",style:{justifyContent:"space-between"},children:[t(y,{size:"sm",children:"From"}),t(Se,{address:h.account.address,client:a})]}),t(m,{y:"md"}),t(ne,{}),t(m,{y:"md"}),r(l,{flex:"row",center:"y",style:{justifyContent:"space-between"},children:[t(y,{size:"sm",children:"To"}),t(Se,{address:o,client:a})]}),t(m,{y:"md"}),t(ne,{}),t(m,{y:"md"}),t(un,{chainId:s.id,client:a,label:"Amount",tokenAmount:d,tokenSymbol:_(c)?O||"":c.symbol,tokenAddress:_(c)?j:c.address}),t(m,{y:"lg"}),g&&r(U,{children:[t(m,{y:"sm"}),r(l,{gap:"sm",flex:"row",style:{justifyContent:"space-between"},center:"y",color:"accentText",children:[t(Xe,{isDone:f==="execute",isActive:f==="transfer",label:f==="transfer"?"Transfer":"Done"}),t(hn,{}),t(Xe,{isDone:!1,label:"Finalize",isActive:f==="execute"})]}),t(m,{y:"lg"})]}),k==="error"&&r(U,{children:[r(l,{flex:"row",gap:"xs",center:"both",color:"danger",children:[t(mn,{width:C.sm,height:C.sm}),t(y,{color:"danger",size:"sm",children:f==="transfer"?"Failed to Transfer":"Failed to Execute"})]}),t(m,{y:"md"})]}),!g&&f==="execute"&&k==="done"&&r(U,{children:[r(l,{flex:"row",gap:"xs",center:"both",color:"success",children:[t(mt,{width:C.sm,height:C.sm}),t(y,{color:"success",size:"sm",children:"Payment completed"})]}),t(m,{y:"md"})]}),h.chain.id!==s.id?t(kt,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(s)}}):r(L,{variant:"accent",fullWidth:!0,disabled:k==="pending",onClick:async()=>{if(f==="execute"){u();return}try{if(T("pending"),g){const B=_(c)?yn({client:a,chain:s,to:o,value:fn(d)}):gn({contract:ge({address:c.address,chain:s,client:a}),to:o,amount:d});await tt({account:e.payer.account,transaction:B}),x("execute"),T("idle")}else{const B=await ni({client:a,fromAddress:h.account.address,toAddress:o,chainId:s.id,tokenAddress:_(c)?j:c.address,amount:d,purchaseData:void 0});console.log("transferResponse",B),B.approval&&(x("approve"),await tt({account:e.payer.account,transaction:B.approval})),x("transfer");const b=B.transactionRequest,p=await ot({account:e.payer.account,transaction:b});v(p.transactionHash),T("idle")}}catch(B){console.error(B),T("error")}},gap:"xs",children:[f==="execute"&&(k==="done"?"Done":"Continue"),f==="transfer"&&(k==="pending"?"Confirming":"Confirm"),f==="approve"&&(k==="pending"?"Approving":"Approve"),k==="pending"&&t(we,{size:"sm",color:"accentButtonText"})]})]})}function ai(e){const[n,i]=w.useState();return n?t(bn,{title:e.title,onBack:e.onBack,onTryAgain:e.onTryAgain,swapTxHash:n,client:e.client,onDone:e.onDone,transactionMode:!1,isEmbed:e.isEmbed,quote:void 0,onSuccess:e.onSuccess}):t(ii,{...e,setTransactionHash:i})}function oi(e){var a;const n=Z(),i=lt(),o=!e.showAllWallets&&((a=e.wallets)==null?void 0:a.every(h=>i.includes(h)));return r(l,{children:[r(l,{flex:"column",gap:"xs",children:[i.map(h=>{var s;const u=(s=h.getAccount())==null?void 0:s.address;return t(Bt,{walletId:h.id,client:e.client,address:u||"",onClick:()=>{e.onSelect(h),e.onBack()},disableChevron:!0,checked:!1},h.id)}),!o&&t(L,{variant:"secondary",fullWidth:!0,onClick:e.onConnect,gap:"xs",bg:"tertiaryBg",style:{borderRadius:V.lg,border:`1px solid ${n.colors.borderColor}`,padding:D.sm},children:r(l,{flex:"row",gap:"sm",center:"y",expand:!0,children:[t(wn,{width:C.md,height:C.md}),t(y,{size:"sm",color:"primaryText",children:"Add Another Wallet"})]})})]}),t(m,{y:"sm"})]})}function ci(){const e=Te(),n=Ct(),i=ft(),[o,a]=w.useState();return w.useEffect(()=>{const s=o==null?void 0:o.wallet;function c(){if(!s){a(void 0);return}const d=s.getAccount(),g=s.getChain();d&&g?(console.log("updated to",d,g),a({account:d,chain:g,wallet:s})):a(void 0)}if(s){const d=s.subscribe("chainChanged",c),g=s.subscribe("accountChanged",c);return()=>{d(),g()}}},[o]),{payer:o||(n&&i&&e?{account:n,chain:i,wallet:e}:void 0),setPayer:a}}function wi(e){const n=kn(e.client);return n.data?t(ri,{...e,supportedDestinations:n.data}):t(Ae,{})}function ri(e){var le,ae,oe,ce,re,se,K,ue,ke,he,De,Re,ze,Oe,Fe,pe,Pe,Me,Le,Ne,qe,_e,je,Ue,He,Qe,$e,Ge;const{client:n,supportedDestinations:i,connectLocale:o,payOptions:a}=e,h=Ct(),{payer:u,setPayer:s}=ci(),[c,d]=w.useState({id:"main"}),[g,v]=w.useState(!1),f=w.useCallback(()=>{d({id:"main"}),e.onDone()},[e.onDone]),{tokenAmount:x,setTokenAmount:k,toChain:T,setToChain:O,deferredTokenAmount:B,fromChain:b,setFromChain:p,toToken:F,setToToken:R,fromToken:P,setFromToken:E,selectedCurrency:q,setSelectedCurrency:A}=Kn({payOptions:a,supportedDestinations:i}),z=Cn({client:e.client,destinationChainId:T.id,destinationTokenAddress:_(F)?j:F.address}),Q=w.useMemo(()=>it(i,a,e.supportedTokens),[e.supportedTokens,i,a]),H=w.useMemo(()=>{var I,S;if(!z.data)return;const W=z.data;return(I=W[0])!=null&&I.chain&&p((S=W[0])==null?void 0:S.chain),it(W,a,e.supportedTokens)},[e.supportedTokens,z.data,a,p]),M=Vn({payOptions:e.payOptions,supportedDestinations:e.supportedDestinations,toChain:T,toToken:F}),$=M.showPaymentSelection===!1&&M.buyWithCryptoEnabled===!1&&M.buyWithFiatEnabled===!1,N=w.useCallback(W=>{var I,S;(S=(I=e.payOptions).onPurchaseSuccess)==null||S.call(I,{type:"crypto",status:W})},[e.payOptions.onPurchaseSuccess]),G=w.useCallback(W=>{var I,S;(S=(I=e.payOptions).onPurchaseSuccess)==null||S.call(I,{type:"fiat",status:W})},[e.payOptions.onPurchaseSuccess]);if(c.id==="connect-payer-wallet")return t(xn,{accountAbstraction:(le=e.connectOptions)==null?void 0:le.accountAbstraction,appMetadata:(ae=e.connectOptions)==null?void 0:ae.appMetadata,chain:(oe=e.connectOptions)==null?void 0:oe.chain,chains:(ce=e.connectOptions)==null?void 0:ce.chains,client:e.client,connectLocale:e.connectLocale,isEmbed:e.isEmbed,onBack:()=>d(c.backScreen),onSelect:W=>{const I=W.getAccount(),S=W.getChain();W&&I&&S&&s({account:I,chain:S,wallet:W})},recommendedWallets:(re=e.connectOptions)==null?void 0:re.recommendedWallets,showAllWallets:((se=e.connectOptions)==null?void 0:se.showAllWallets)===void 0?!0:(K=e.connectOptions)==null?void 0:K.showAllWallets,walletConnect:(ue=e.connectOptions)==null?void 0:ue.walletConnect,wallets:(he=(ke=e.connectOptions)==null?void 0:ke.wallets)==null?void 0:he.filter(W=>W.id!=="inApp")});if(c.id==="swap-flow"&&u)return t(Sn,{title:e.title,transactionMode:a.mode==="transaction",isEmbed:e.isEmbed,client:n,onBack:()=>{d({id:"buy-with-crypto"})},buyWithCryptoQuote:c.quote,payer:u,isFiatFlow:!1,onDone:f,onTryAgain:()=>{d({id:"buy-with-crypto"})},onSuccess:N});if(c.id==="fiat-flow"&&u)return t(Gn,{title:e.title,transactionMode:a.mode==="transaction",quote:c.quote,onBack:()=>{d({id:"buy-with-fiat"})},client:n,testMode:e.payOptions.buyWithFiat!==!1&&((De=e.payOptions.buyWithFiat)==null?void 0:De.testMode)===!0,theme:typeof e.theme=="string"?e.theme:e.theme.type,openedWindow:c.openedWindow,onDone:f,isEmbed:e.isEmbed,payer:u,onSuccess:G});if(c.id==="transfer-flow"&&u&&h){const W=()=>d({id:"buy-with-crypto"}),S=((ze=(Re=e.payOptions)==null?void 0:Re.paymentInfo)==null?void 0:ze.sellerAddress)||h.address;return t(ai,{title:e.title,onBack:W,payer:u,client:e.client,chain:T,token:F,tokenAmount:x,receiverAddress:S,transactionMode:e.payOptions.mode==="transaction",isEmbed:e.isEmbed,onDone:f,onTryAgain:()=>{d({id:"buy-with-crypto"})},onSuccess:N})}if(c.id==="select-currency"){const W=()=>d(c.backScreen);return t(Un,{onSelect:I=>{W(),A(I)},onBack:W})}if(c.id==="select-to-token"){const W=i.map(X=>X.chain),I=()=>d(c.backScreen),S=(Oe=a==null?void 0:a.prefillBuy)==null?void 0:Oe.allowEdits;return(S==null?void 0:S.token)===!1?t(at,{chains:W,client:e.client,connectLocale:e.connectLocale,setChain:O,goBack:I}):t(et,{onBack:I,tokenList:((T!=null&&T.id?Q[T.id]:void 0)||[]).filter(X=>X.address!==j),onTokenSelect:X=>{R(X),I()},chain:T,chainSelection:(S==null?void 0:S.chain)!==!1?{chains:W,select:X=>{O(X)}}:void 0,connectLocale:o,client:n,modalTitle:e.title})}if(c.id==="select-from-token"&&z.data&&H){const W=z.data.map(S=>S.chain),I=()=>d(c.backScreen);return a.buyWithCrypto!==!1&&((Pe=(pe=(Fe=a.buyWithCrypto)==null?void 0:Fe.prefillSource)==null?void 0:pe.allowEdits)==null?void 0:Pe.token)===!1?t(at,{chains:W,client:e.client,connectLocale:e.connectLocale,setChain:p,goBack:I}):t(et,{onBack:I,tokenList:((b!=null&&b.id?H[b.id]:void 0)||[]).filter(S=>S.address!==j),onTokenSelect:S=>{E(S),I()},chain:b,chainSelection:a.buyWithCrypto!==!1&&((Ne=(Le=(Me=a.buyWithCrypto)==null?void 0:Me.prefillSource)==null?void 0:Le.allowEdits)==null?void 0:Ne.chain)!==!1?{chains:z.data.map(S=>S.chain),select:S=>p(S)}:void 0,connectLocale:o,client:n,modalTitle:"Pay with"})}return t(l,{animate:"fadein",children:r("div",{children:[c.id==="main"&&t(di,{title:e.title,payerAccount:u==null?void 0:u.account,client:n,onSelectBuyToken:()=>d({id:"select-to-token",backScreen:c}),payOptions:a,setTokenAmount:k,setToChain:O,setToToken:R,setFromChain:p,setFromToken:E,toChain:T,toToken:F,tokenAmount:x,connectOptions:e.connectOptions,setScreen:d,supportedDestinations:i,onBack:e.onBack,theme:e.theme,hasEditedAmount:g,setHasEditedAmount:v,enabledPaymentMethods:M}),(c.id==="select-payment-method"||c.id==="select-wallet"||c.id==="buy-with-crypto"||c.id==="buy-with-fiat")&&u&&r(li,{title:e.title,selectedChain:T,selectedToken:F,tokenAmount:x,client:n,onBack:()=>{M.showPaymentSelection&&(c.id==="select-wallet"||c.id==="buy-with-fiat")?d({id:"select-payment-method"}):c.id==="buy-with-crypto"?d({id:"select-wallet"}):d({id:"main"})},children:[c.id==="select-payment-method"&&t(ui,{setScreen:W=>d({id:W})}),c.id==="select-wallet"&&t(oi,{client:n,onSelect:W=>{const I=W.getChain(),S=W.getAccount();I&&S&&(s({account:S,chain:I,wallet:W}),d({id:"buy-with-crypto"}))},showAllWallets:!!((qe=e.connectOptions)!=null&&qe.showAllWallets),wallets:(_e=e.connectOptions)==null?void 0:_e.wallets,onBack:()=>{},onConnect:()=>{d({id:"connect-payer-wallet",backScreen:{id:"select-wallet"}})},selectedAddress:u.account.address}),c.id==="buy-with-crypto"&&h&&t(hi,{setScreen:d,tokenAmount:B,toChain:T,toToken:F,fromChain:b,fromToken:P,showFromTokenSelector:()=>{d({id:"select-from-token",backScreen:c})},payer:u,client:n,isEmbed:e.isEmbed,onDone:f,payOptions:a,connectLocale:o,connectOptions:e.connectOptions,setPayer:s,activeAccount:h,setTokenAmount:k,setHasEditedAmount:v,disableTokenSelection:$===!0||a.buyWithCrypto!==!1&&((He=(Ue=(je=a.buyWithCrypto)==null?void 0:je.prefillSource)==null?void 0:Ue.allowEdits)==null?void 0:He.chain)===!1&&((Ge=($e=(Qe=a.buyWithCrypto)==null?void 0:Qe.prefillSource)==null?void 0:$e.allowEdits)==null?void 0:Ge.token)===!1}),c.id==="buy-with-fiat"&&t(mi,{setScreen:d,tokenAmount:B,toChain:T,toToken:F,selectedCurrency:q,client:n,isEmbed:e.isEmbed,onDone:f,payOptions:a,theme:e.theme,showCurrencySelector:()=>{d({id:"select-currency",backScreen:c})},payer:u,setTokenAmount:k,setHasEditedAmount:v})]})]})})}function si(e){return t("div",{children:r(l,{flex:"row",gap:"sm",center:"y",style:{justifyContent:"space-between"},children:[r(l,{flex:"row",gap:"xs",center:"y",children:[t(y,{color:"primaryText","data-testid":"tokenAmount",size:"xl",children:J(Number(e.tokenAmount),6)}),r(l,{flex:"row",gap:"xxs",center:"y",children:[t(ie,{token:e.selectedToken,chain:e.selectedChain,size:"md",color:"secondaryText"}),t(wt,{chain:e.selectedChain,client:e.client,size:"sm",token:e.selectedToken})]})]}),t(En,{chain:e.selectedChain,client:e.client,size:"sm",short:!0})]})})}function di(e){var b,p,F,R,P,E;const{setTokenAmount:n,setToChain:i,setToToken:o,setFromChain:a,setFromToken:h,payerAccount:u,client:s,tokenAmount:c,payOptions:d,toToken:g,toChain:v,supportedDestinations:f,enabledPaymentMethods:x}=e,{showPaymentSelection:k,buyWithCryptoEnabled:T,buyWithFiatEnabled:O}=x,B=!c;switch(d.mode){case"transaction":return t(jn,{supportedDestinations:f,payUiOptions:d,payerAccount:u,connectOptions:e.connectOptions,client:s,onContinue:(q,A,z)=>{n(q),i(A),a(A),h(z),o(z),k?e.setScreen({id:"select-payment-method"}):T?e.setScreen({id:"select-wallet"}):O?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-wallet"})}});case"direct_payment":return t(Mn,{client:s,payUiOptions:d,payerAccount:u,connectOptions:e.connectOptions,supportedDestinations:f,onContinue:(q,A,z)=>{n(q),i(A),a(A),h(z),o(z),k?e.setScreen({id:"select-payment-method"}):T?e.setScreen({id:"buy-with-crypto"}):O?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-wallet"})}});default:return r(l,{p:"lg",children:[t(ee,{title:e.title,onBack:e.onBack}),t(m,{y:"xl"}),t(Zn,{value:c,onChange:async q=>{e.setHasEditedAmount(!0),n(q)},freezeAmount:((p=(b=d.prefillBuy)==null?void 0:b.allowEdits)==null?void 0:p.amount)===!1,freezeChainAndToken:((R=(F=d.prefillBuy)==null?void 0:F.allowEdits)==null?void 0:R.chain)===!1&&((E=(P=d.prefillBuy)==null?void 0:P.allowEdits)==null?void 0:E.token)===!1,token:g,chain:v,onSelectToken:e.onSelectBuyToken,client:e.client}),t(m,{y:"xl"}),t(l,{flex:"column",gap:"sm",children:u?t(L,{variant:"accent",fullWidth:!0,disabled:B,"data-disabled":B,onClick:()=>{k?e.setScreen({id:"select-payment-method"}):T?e.setScreen({id:"buy-with-crypto"}):O?e.setScreen({id:"buy-with-fiat"}):console.error("No payment method enabled")},children:"Continue"}):t("div",{children:t(Ie,{...e.connectOptions,client:e.client,theme:e.theme,connectButton:{style:{width:"100%"}}})})})]})}}function li(e){return r(l,{children:[t(l,{p:"lg",children:t(ee,{title:e.title,onBack:e.onBack})}),r(l,{px:"lg",style:{paddingBottom:D.lg},children:[t(m,{y:"xs"}),t(si,{selectedToken:e.selectedToken,selectedChain:e.selectedChain,tokenAmount:e.tokenAmount,client:e.client}),t(m,{y:"md"}),t(ne,{}),t(m,{y:"lg"}),t(y,{size:"sm",children:" Pay with "}),t(m,{y:"sm"}),e.children]})]})}function ui(e){return t(l,{animate:"fadein",children:r(l,{flex:"column",gap:"sm",children:[r(L,{variant:"outline",bg:"tertiaryBg",onClick:()=>e.setScreen("buy-with-fiat"),gap:"sm",style:{justifyContent:"flex-start",textAlign:"left"},children:[t(l,{color:"secondaryText",flex:"row",center:"both",children:t(Tn,{style:{width:C.md,height:C.md}})}),r(l,{flex:"column",gap:"xxs",children:[t(y,{size:"md",color:"primaryText",children:"Credit Card"}),t(y,{size:"xs",children:"Securely pay with credit card"})]})]}),r(L,{variant:"outline",bg:"tertiaryBg",onClick:()=>e.setScreen("select-wallet"),style:{justifyContent:"flex-start"},gap:"sm",children:[t(l,{color:"secondaryText",flex:"row",center:"both",children:t(An,{size:C.md})}),r(l,{flex:"column",gap:"xxs",children:[t(y,{size:"md",color:"primaryText",children:"Crypto"}),t(y,{size:"xs",children:"Pay with your connected wallet"})]})]})]})})}function hi(e){var ae,oe,ce,re,se;const{setScreen:n,payer:i,client:o,toChain:a,tokenAmount:h,toToken:u,fromChain:s,fromToken:c,showFromTokenSelector:d,payOptions:g,disableTokenSelection:v}=e,x=((oe=(ae=e.payOptions)==null?void 0:ae.paymentInfo)==null?void 0:oe.sellerAddress)||e.activeAccount.address,{drawerRef:k,drawerOverlayRef:T,isOpen:O,setIsOpen:B}=At(),[b,p]=w.useState("fees"),F=bt({address:i.account.address,chain:s,tokenAddress:_(c)?void 0:c.address,client:o}),R=_(c)?j:c.address.toLowerCase(),P=_(u)?j:u.address.toLowerCase(),E=!!h&&!(s.id===a.id&&R===P),q=E?{fromAddress:i.account.address,toAddress:x,fromChainId:s.id,fromTokenAddress:_(c)?j:c.address,toChainId:a.id,toTokenAddress:_(u)?j:u.address,toAmount:h,client:o,purchaseData:g.purchaseData}:void 0,A=zn(q,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),z=E?(ce=A.data)==null?void 0:ce.swapDetails.fromAmount:h,Q=!!z&&!!F.data&&Number(F.data.displayValue)<Number(z),H=E&&!A.data||Q,M=e.payer.chain.id!==s.id;function $(K){const ue="Unable to get price quote";try{if(K.error.code==="MINIMUM_PURCHASE_AMOUNT"){const he=K.error.data.minimumAmountEth;return{minAmount:J(Number(he),6)}}}catch{}return{msg:[ue]}}const N=!A.isLoading&&A.error?$(A.error):void 0;function G(){if((e.payOptions.mode==="transaction"||e.payOptions.mode==="direct_payment")&&!Q&&!E){i.account.address!==x?n({id:"transfer-flow"}):e.onDone();return}A.data&&n({id:"swap-flow",quote:A.data})}function le(){A.data&&(B(!0),p("fees"))}return r(l,{flex:"column",gap:"md",animate:"fadein",children:[O&&r(U,{children:[t(Tt,{ref:T}),t(St,{ref:k,close:()=>B(!1),children:b==="fees"&&A.data&&r("div",{children:[t(y,{size:"lg",color:"primaryText",children:"Fees"}),t(m,{y:"lg"}),t(Wn,{quote:A.data,align:"left"})]})})]}),r("div",{children:[t(Bt,{client:e.client,onClick:()=>{n({id:"select-wallet"})},address:e.payer.account.address,walletId:e.payer.wallet.id,containerStyle:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}),t(ti,{value:z||"",onSelectToken:d,chain:s,token:c,isLoading:A.isLoading&&!z,client:o,freezeChainAndTokenSelection:v,payerAccount:e.payer.account,swapRequired:E}),E&&t(Wt,{quoteIsLoading:A.isLoading,estimatedSeconds:(re=A.data)==null?void 0:re.swapDetails.estimated.durationSeconds,onViewFees:le}),t(m,{y:"md"})]}),N&&r("div",{children:[N.minAmount&&r(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is ",N.minAmount," ",t(ie,{token:u,chain:a,size:"sm",inline:!0,color:"danger"})]}),(se=N.msg)==null?void 0:se.map(K=>t(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:K},K))]}),!N&&Q&&r("div",{children:[t(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:"Not enough funds."}),t(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:"Try a different wallet or token."})]}),N!=null&&N.minAmount?t(L,{variant:"accent",fullWidth:!0,onClick:()=>{e.setTokenAmount(String(N.minAmount)),e.setHasEditedAmount(!0)},children:"Set Minimum"}):M&&!A.isLoading&&!Q&&!A.error?t(kt,{variant:"accent",fullWidth:!0,switchChain:async()=>{await e.payer.wallet.switchChain(s)}}):t(L,{variant:H?"outline":"accent",fullWidth:!0,"data-disabled":H,disabled:H,onClick:async()=>{H||G()},gap:"xs",children:A.isLoading?r(U,{children:["Getting price quote",t(we,{size:"sm",color:"accentText"})]}):"Continue"})]})}function mi(e){var q,A,z,Q,H;const{toToken:n,tokenAmount:i,payer:o,client:a,setScreen:h,toChain:u,showCurrencySelector:s,selectedCurrency:c}=e,g=((A=(q=e.payOptions)==null?void 0:q.paymentInfo)==null?void 0:A.sellerAddress)||e.payer.account.address,{drawerRef:v,drawerOverlayRef:f,isOpen:x,setIsOpen:k}=At(),[T,O]=w.useState("fees"),B=e.payOptions.buyWithFiat,b=Fn(B!==!1&&i?{fromCurrencySymbol:c.shorthand,toChainId:u.id,toAddress:g,toTokenAddress:_(n)?j:n.address,toAmount:i,client:a,isTestMode:B==null?void 0:B.testMode,purchaseData:e.payOptions.purchaseData,fromAddress:o.account.address}:void 0);function p(){if(!b.data)return;const M=xt(b.data);let $=null;M||($=vt(b.data.onRampLink,typeof e.theme=="string"?e.theme:e.theme.type),yt({type:"fiat",intentId:b.data.intentId})),h({id:"fiat-flow",quote:b.data,openedWindow:$})}function F(){b.data&&(O("fees"),k(!0))}function R(M){const $="Unable to get price quote";try{if(M.error.code==="MINIMUM_PURCHASE_AMOUNT"){const G=M.error.data.minimumAmountEth;return{minAmount:J(Number(G),6)}}}catch{}return{msg:[$]}}const P=!b.data,E=!b.isLoading&&b.error?R(b.error):void 0;return r(l,{flex:"column",gap:"md",animate:"fadein",children:[x&&r(U,{children:[t(Tt,{ref:f}),t(St,{ref:v,close:()=>k(!1),children:T==="fees"&&b.data&&r("div",{children:[t(y,{size:"lg",color:"primaryText",children:"Fees"}),t(m,{y:"lg"}),t(Bn,{quote:b.data})]})})]}),r("div",{children:[t(Nn,{isLoading:b.isLoading,value:(z=b.data)==null?void 0:z.fromCurrencyWithFees.amount,client:a,currency:c,onSelectCurrency:s}),t(Wt,{quoteIsLoading:b.isLoading,estimatedSeconds:(Q=b.data)==null?void 0:Q.estimatedDurationSeconds,onViewFees:F}),t(m,{y:"md"})]}),E&&r("div",{children:[E.minAmount&&r(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is ",E.minAmount," ",t(ie,{token:n,chain:u,size:"sm",inline:!0,color:"danger"})]}),(H=E.msg)==null?void 0:H.map(M=>t(y,{color:"danger",size:"sm",center:!0,multiline:!0,children:M},M))]}),E!=null&&E.minAmount?t(L,{variant:"accent",fullWidth:!0,onClick:()=>{e.setTokenAmount(String(E.minAmount)),e.setHasEditedAmount(!0)},children:"Set Minimum"}):t(L,{variant:P?"outline":"accent","data-disabled":P,disabled:P,fullWidth:!0,onClick:p,gap:"xs",children:b.isLoading?r(U,{children:["Getting price quote",t(we,{size:"sm",color:"accentText"})]}):"Continue"})]})}function it(e,n,i){const o={},a=n.buyWithFiat===!1,h=n.buyWithCrypto===!1;for(const u of e)o[u.chain.id]=u.tokens.filter(s=>s.buyWithCryptoEnabled&&s.buyWithFiatEnabled?!0:!(!s.buyWithCryptoEnabled&&a||!s.buyWithFiatEnabled&&h));if(i)for(const u in i){const s=Number(u),c=i[s];c&&(o[s]=c)}return o}function at(e){return t(vn,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.goBack,chains:e.chains,closeModal:e.goBack,networkSelector:{renderChain(n){return t(In,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.goBack()},client:e.client,connectLocale:e.connectLocale})}}})}export{wi as default};
